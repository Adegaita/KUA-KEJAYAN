<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KUA Kejayan – Data Catin 2025</title>
  <meta name="description" content="Statistik Data Catin 2025 KUA Kejayan dengan filter Bulan (Jan–Des) dan Desa. CSV tertanam (single file)." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{scroll-behavior:smooth}
    .container{max-width:72rem}
    .chip{display:inline-block;border-radius:9999px;padding:.25rem .6rem;border:1px solid #e5e7eb;background:#fff;font-size:.75rem;margin:.125rem .25rem}
    .chip.active{background:#10b9811a;border-color:#10b981;color:#065f46}
    table td, table th{white-space:nowrap}
    .scroll-x{overflow-x:auto}
  </style>
</head>
<body class="min-h-screen bg-white text-gray-900">
  <!-- NAV -->
  <header class="sticky top-0 z-50 w-full border-b bg-white/80 backdrop-blur">
    <div class="mx-auto container flex items-center justify-between px-4 py-3">
      <a href="index.html" class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-emerald-600"></div>
        <div><div class="text-lg font-bold">KUA Kejayan</div><div class="text-xs text-gray-500">Kantor Urusan Agama Kejayan</div></div>
      </a>
      <nav class="hidden gap-4 md:flex text-sm">
        <a href="index.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Beranda</a>
        <a href="layanan.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Layanan</a>
        <a href="informasi.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Informasi</a>
        <a href="data-catin.html" class="px-3 py-2 rounded-xl hover:bg-gray-100 font-semibold">Data Catin</a>
        <a href="media.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Media</a>
        <a href="kontak.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Kontak</a>
        <a href="login.html" class="px-3 py-2 rounded-xl hover:bg-gray-100">Login</a>
      </nav>
    </div>
  </header>

  <section class="py-12">
    <div class="mx-auto container px-4">
      <h2 class="text-2xl font-bold">Data Catin 2025</h2>
      <p class="mt-1 text-gray-600">Filter lengkap Bulan Jan–Des & Desa.</p>

      <!-- Filter Bar -->
      <div class="mt-6 grid grid-cols-1 gap-3 md:grid-cols-4">
        <div class="md:col-span-2">
          <label class="block text-sm text-gray-600 mb-1">Bulan</label>
          <select id="bulanSelect" class="w-full rounded-2xl border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-600">
            <option value="ALL">Semua Bulan</option>
            <option value="1">Jan</option>
            <option value="2">Feb</option>
            <option value="3">Mar</option>
            <option value="4">Apr</option>
            <option value="5">Mei</option>
            <option value="6">Jun</option>
            <option value="7">Jul</option>
            <option value="8">Agu</option>
            <option value="9">Sep</option>
            <option value="10">Okt</option>
            <option value="11">Nov</option>
            <option value="12">Des</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm text-gray-600 mb-1">Desa/Kelurahan</label>
          <select id="desaSelect" class="w-full rounded-2xl border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-600">
            <option value="ALL">Semua Desa</option>
          </select>
        </div>
        <div class="md:col-span-3">
          <label class="block text-sm text-gray-600 mb-1">Cari (nama desa)</label>
          <input id="searchInput" placeholder="Ketik untuk mencari desa..." class="w-full rounded-2xl border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-600"/>
        </div>
        <div class="flex items-end gap-2">
          <button id="resetBtn" class="rounded-2xl border px-4 py-2 text-sm font-semibold hover:bg-gray-50">Reset</button>
          <button id="downloadBtn" class="rounded-2xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700">Unduh CSV</button>
        </div>
      </div>

      <!-- Chips Ringkas Jan–Des -->
      <div class="mt-6">
        <div class="text-sm text-gray-600 mb-2">Ringkasan per Bulan (global)</div>
        <div id="chipsBulan"></div>
      </div>

      <!-- KPI -->
      <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-3">
        <div class="rounded-3xl border p-6">
          <div class="text-sm text-gray-600">Total (sesuai filter)</div>
          <div id="kpiTotal" class="mt-1 text-3xl font-bold">—</div>
        </div>
        <div class="rounded-3xl border p-6">
          <div class="text-sm text-gray-600">Bulan Terbanyak</div>
          <div id="kpiTopMonth" class="mt-1 text-xl font-semibold">—</div>
        </div>
        <div class="rounded-3xl border p-6">
          <div class="text-sm text-gray-600">Desa Terbanyak</div>
          <div id="kpiTopDesa" class="mt-1 text-xl font-semibold">—</div>
        </div>
      </div>

      <!-- Tabel -->
      <div class="mt-8 rounded-3xl border p-4 scroll-x">
        <table class="min-w-full text-sm" id="dataTable">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-3 py-2 text-left font-semibold">Desa</th>
              <th class="px-3 py-2 text-left font-semibold">Bulan</th>
              <th class="px-3 py-2 text-left font-semibold">Jumlah</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div id="noData" class="hidden text-sm text-gray-600 p-3">Tidak ada data untuk filter ini.</div>
      </div>

      <!-- Pagination -->
      <div class="mt-4 flex items-center justify-between text-sm">
        <div><span id="pageInfo">Halaman 1/1</span></div>
        <div class="flex gap-2">
          <button id="prevBtn" class="rounded-xl border px-3 py-1 hover:bg-gray-50">Prev</button>
          <button id="nextBtn" class="rounded-xl border px-3 py-1 hover:bg-gray-50">Next</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="border-t bg-white">
    <div class="mx-auto container flex items-center justify-between px-4 py-6 text-sm">
      <div>© <span id="year"></span> KUA Kejayan</div>
      <div class="flex gap-4">
        <a href="https://instagram.com/kuakejayan" target="_blank" class="hover:underline">Instagram</a>
        <a href="https://youtube.com/@kuakejayan" target="_blank" class="hover:underline">YouTube</a>
      </div>
    </div>
  </footer>

  <!-- CSV tertanam -->
  <script type="text/csv" id="catinCsv">DESA,BULAN,JUMLAH
AMBAL AMBIL,1,2
AMBAL AMBIL,2,1
AMBAL AMBIL,3,0
AMBAL AMBIL,4,5
AMBAL AMBIL,5,0
AMBAL AMBIL,6,9
AMBAL AMBIL,7,0
AMBAL AMBIL,8,0
AMBAL AMBIL,9,0
AMBAL AMBIL,10,0
AMBAL AMBIL,11,0
AMBAL AMBIL,12,0
BENERWOJO,1,1
BENERWOJO,2,0
BENERWOJO,3,0
BENERWOJO,4,2
BENERWOJO,5,0
BENERWOJO,6,6
BENERWOJO,7,0
BENERWOJO,8,1
BENERWOJO,9,1
BENERWOJO,10,0
BENERWOJO,11,0
BENERWOJO,12,0
COBANJOYO,1,0
COBANJOYO,2,1
COBANJOYO,3,0
COBANJOYO,4,3
COBANJOYO,5,0
COBANJOYO,6,7
COBANJOYO,7,0
COBANJOYO,8,1
COBANJOYO,9,0
COBANJOYO,10,0
COBANJOYO,11,0
COBANJOYO,12,0
KEDEMUNGAN,1,2
KEDEMUNGAN,2,3
KEDEMUNGAN,3,0
KEDEMUNGAN,4,0
KEDEMUNGAN,5,0
KEDEMUNGAN,6,10
KEDEMUNGAN,7,0
KEDEMUNGAN,8,0
KEDEMUNGAN,9,0
KEDEMUNGAN,10,0
KEDEMUNGAN,11,0
KEDEMUNGAN,12,0
KEDUNGPENGARON,1,0
KEDUNGPENGARON,2,0
KEDUNGPENGARON,3,0
KEDUNGPENGARON,4,1
KEDUNGPENGARON,5,0
KEDUNGPENGARON,6,1
KEDUNGPENGARON,7,2
KEDUNGPENGARON,8,0
KEDUNGPENGARON,9,0
KEDUNGPENGARON,10,0
KEDUNGPENGARON,11,0
KEDUNGPENGARON,12,0
KEJAYAN,1,4
KEJAYAN,2,4
KEJAYAN,3,0
KEJAYAN,4,13
KEJAYAN,5,0
KEJAYAN,6,8
KEJAYAN,7,2
KEJAYAN,8,10
KEJAYAN,9,3
KEJAYAN,10,0
KEJAYAN,11,0
KEJAYAN,12,0
KEPUH,1,1
KEPUH,2,0
KEPUH,3,0
KEPUH,4,0
KEPUH,5,0
KEPUH,6,1
KEPUH,7,0
KEPUH,8,0
KEPUH,9,0
KEPUH,10,0
KEPUH,11,0
KEPUH,12,0
KETANGIREJO,1,0
KETANGIREJO,2,0
KETANGIREJO,3,0
KETANGIREJO,4,0
KETANGIREJO,5,0
KETANGIREJO,6,1
KETANGIREJO,7,0
KETANGIREJO,8,0
KETANGIREJO,9,0
KETANGIREJO,10,0
KETANGIREJO,11,0
KETANGIREJO,12,0
KLANGRONG,1,1
KLANGRONG,2,1
KLANGRONG,3,0
KLANGRONG,4,2
KLANGRONG,5,0
KLANGRONG,6,5
KLANGRONG,7,0
KLANGRONG,8,2
KLANGRONG,9,2
KLANGRONG,10,0
KLANGRONG,11,0
KLANGRONG,12,0
KLINTER,1,1
KLINTER,2,0
KLINTER,3,1
KLINTER,4,3
KLINTER,5,1
KLINTER,6,3
KLINTER,7,0
KLINTER,8,0
KLINTER,9,0
KLINTER,10,0
KLINTER,11,0
KLINTER,12,0
KURUNG,1,2
KURUNG,2,1
KURUNG,3,1
KURUNG,4,3
KURUNG,5,0
KURUNG,6,1
KURUNG,7,0
KURUNG,8,1
KURUNG,9,0
KURUNG,10,0
KURUNG,11,0
KURUNG,12,0
LINGGO,1,0
LINGGO,2,0
LINGGO,3,0
LINGGO,4,0
LINGGO,5,0
LINGGO,6,4
LINGGO,7,0
LINGGO,8,0
LINGGO,9,0
LINGGO,10,0
LINGGO,11,0
LINGGO,12,0
LOROKAN,1,3
LOROKAN,2,0
LOROKAN,3,0
LOROKAN,4,0
LOROKAN,5,1
LOROKAN,6,4
LOROKAN,7,0
LOROKAN,8,1
LOROKAN,9,1
LOROKAN,10,0
LOROKAN,11,0
LOROKAN,12,0
LUWUK,1,1
LUWUK,2,2
LUWUK,3,0
LUWUK,4,4
LUWUK,5,0
LUWUK,6,2
LUWUK,7,0
LUWUK,8,1
LUWUK,9,1
LUWUK,10,0
LUWUK,11,0
LUWUK,12,0
ORO ORO PULEH,1,0
ORO ORO PULEH,2,1
ORO ORO PULEH,3,0
ORO ORO PULEH,4,1
ORO ORO PULEH,5,1
ORO ORO PULEH,6,2
ORO ORO PULEH,7,0
ORO ORO PULEH,8,0
ORO ORO PULEH,9,0
ORO ORO PULEH,10,0
ORO ORO PULEH,11,0
ORO ORO PULEH,12,0
PACAR KELING,1,2
PACAR KELING,2,4
PACAR KELING,3,0
PACAR KELING,4,4
PACAR KELING,5,0
PACAR KELING,6,5
PACAR KELING,7,0
PACAR KELING,8,0
PACAR KELING,9,2
PACAR KELING,10,0
PACAR KELING,11,0
PACAR KELING,12,0
PATEBON,1,3
PATEBON,2,1
PATEBON,3,0
PATEBON,4,2
PATEBON,5,0
PATEBON,6,3
PATEBON,7,0
PATEBON,8,0
PATEBON,9,0
PATEBON,10,0
PATEBON,11,0
PATEBON,12,0
RANDUGONG,1,1
RANDUGONG,2,0
RANDUGONG,3,0
RANDUGONG,4,0
RANDUGONG,5,0
RANDUGONG,6,2
RANDUGONG,7,0
RANDUGONG,8,0
RANDUGONG,9,0
RANDUGONG,10,0
RANDUGONG,11,0
RANDUGONG,12,0
SLADI,1,1
SLADI,2,2
SLADI,3,0
SLADI,4,7
SLADI,5,2
SLADI,6,4
SLADI,7,0
SLADI,8,1
SLADI,9,1
SLADI,10,0
SLADI,11,0
SLADI,12,0
SUMBER BANTENG,1,0
SUMBER BANTENG,2,2
SUMBER BANTENG,3,0
SUMBER BANTENG,4,3
SUMBER BANTENG,5,0
SUMBER BANTENG,6,1
SUMBER BANTENG,7,0
SUMBER BANTENG,8,1
SUMBER BANTENG,9,0
SUMBER BANTENG,10,0
SUMBER BANTENG,11,0
SUMBER BANTENG,12,0
SUMBER SUKO,1,0
SUMBER SUKO,2,0
SUMBER SUKO,3,0
SUMBER SUKO,4,1
SUMBER SUKO,5,0
SUMBER SUKO,6,1
SUMBER SUKO,7,0
SUMBER SUKO,8,0
SUMBER SUKO,9,0
SUMBER SUKO,10,0
SUMBER SUKO,11,0
SUMBER SUKO,12,0
TANGGULANGIN,1,1
TANGGULANGIN,2,2
TANGGULANGIN,3,0
TANGGULANGIN,4,2
TANGGULANGIN,5,3
TANGGULANGIN,6,4
TANGGULANGIN,7,0
TANGGULANGIN,8,0
TANGGULANGIN,9,0
TANGGULANGIN,10,0
TANGGULANGIN,11,0
TANGGULANGIN,12,0
TUNDOSORO,1,3
TUNDOSORO,2,2
TUNDOSORO,3,0
TUNDOSORO,4,1
TUNDOSORO,5,0
TUNDOSORO,6,6
TUNDOSORO,7,3
TUNDOSORO,8,0
TUNDOSORO,9,2
TUNDOSORO,10,0
TUNDOSORO,11,0
TUNDOSORO,12,0
WANGKAL W,1,2
WANGKAL W,2,0
WANGKAL W,3,0
WANGKAL W,4,1
WANGKAL W,5,0
WANGKAL W,6,1
WANGKAL W,7,0
WANGKAL W,8,0
WANGKAL W,9,0
WANGKAL W,10,0
WANGKAL W,11,0
WANGKAL W,12,0
WRATI,1,3
WRATI,2,2
WRATI,3,0
WRATI,4,3
WRATI,5,1
WRATI,6,8
WRATI,7,1
WRATI,8,0
WRATI,9,0
WRATI,10,0
WRATI,11,0
WRATI,12,0
</script>

  <script>
    document.getElementById('year').textContent=new Date().getFullYear();

    function monthName(i){ return ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Des"][i-1]||String(i); }
    function pad2(n){ return (n<10?'0':'')+n; }

    // Parser CSV robust (quotes-aware)
    function parseCSV(text){
      const rows=[]; let row=[], field=''; let i=0, inQ=false;
      while(i<text.length){
        const c=text[i];
        if(inQ){
          if(c=='"'){
            if(text[i+1]=='"'){ field+='"'; i+=2; continue; }
            inQ=false; i++; continue;
          } else { field+=c; i++; continue; }
        } else {
          if(c=='"'){ inQ=true; i++; continue; }
          if(c==','){ row.push(field); field=''; i++; continue; }
          if(c=='\n'){ row.push(field); rows.push(row); row=[]; field=''; i++; continue; }
          if(c=='\r'){ i++; continue; }
          field+=c; i++;
        }
      }
      row.push(field); rows.push(row);
      return rows;
    }

    // Chips Jan–Des (nanti diisi angka global setelah data diproses)
    const chipsWrap = document.getElementById('chipsBulan');
    chipsWrap.innerHTML = Array.from({length:12}, (_,i)=>{
      const m=i+1; return `<span class="chip" data-m="${m}">${pad2(m)} ${monthName(m)} <b>(0)</b></span>`;
    }).join('');
    chipsWrap.addEventListener('click', (e)=>{
      const el=e.target.closest('.chip'); if(!el) return;
      document.getElementById('bulanSelect').value=el.getAttribute('data-m');
      applyFilter();
    });

    let data=[], filtered=[], page=1, pageSize=25;

    function summarize(arr){
      const byM=new Map(), byD=new Map();
      for(const r of arr){
        const m=Number(r.BULAN), d=r.DESA, j=Number(r.JUMLAH)||0;
        byM.set(m,(byM.get(m)||0)+j);
        byD.set(d,(byD.get(d)||0)+j);
      }
      const topM=Array.from(byM.entries()).sort((a,b)=>b[1]-a[1])[0];
      const topD=Array.from(byD.entries()).sort((a,b)=>b[1]-a[1])[0];
      return { total: arr.reduce((s,r)=>s+(Number(r.JUMLAH)||0),0),
               topMonth: topM ? `${pad2(topM[0])} ${monthName(topM[0])} (${topM[1]})` : '—',
               topDesa : topD ? `${topD[0]} (${topD[1]})` : '—' };
    }

    function renderBody(){
      const start=(page-1)*pageSize;
      const slice=filtered.slice(start,start+pageSize);
      document.getElementById('tbody').innerHTML = slice.map(r=>`
        <tr>
          <td class="px-3 py-1 border-t">${r.DESA}</td>
          <td class="px-3 py-1 border-t">${pad2(Number(r.BULAN))} ${monthName(Number(r.BULAN))}</td>
          <td class="px-3 py-1 border-t text-right">${Number(r.JUMLAH)||0}</td>
        </tr>
      `).join('');
      document.getElementById('noData').classList.toggle('hidden', slice.length>0);
      const totalPages=Math.max(1, Math.ceil(filtered.length/pageSize));
      document.getElementById('pageInfo').textContent = `Halaman ${page}/${totalPages}`;
    }

    function applyFilter(){
      const mVal=document.getElementById('bulanSelect').value;
      const dVal=document.getElementById('desaSelect').value;
      const q=(document.getElementById('searchInput').value||'').trim().toLowerCase();

      filtered = data.filter(r=>{
        const byM = (mVal==='ALL') || (String(r.BULAN)===String(mVal));
        const byD = (dVal==='ALL') || (r.DESA===dVal);
        const byQ = !q || (r.DESA||'').toLowerCase().includes(q);
        return byM && byD && byQ;
      });

      const k=summarize(filtered);
      document.getElementById('kpiTotal').textContent = k.total;
      document.getElementById('kpiTopMonth').textContent = k.topMonth;
      document.getElementById('kpiTopDesa').textContent  = k.topDesa;

      // Global monthly counts (tidak terpengaruh filter)
      const gByM=new Map();
      for(const r of data){ const m=Number(r.BULAN), j=Number(r.JUMLAH)||0; gByM.set(m,(gByM.get(m)||0)+j); }
      document.querySelectorAll('#chipsBulan .chip').forEach((chip, idx)=>{
        const m=idx+1, count=gByM.get(m)||0;
        chip.innerHTML = `${pad2(m)} ${monthName(m)} <b>(${count})</b>`;
        chip.classList.toggle('active', mVal!=='ALL' && String(m)===String(mVal));
      });

      page=1; renderBody();
    }

    // Events
    document.getElementById('bulanSelect').addEventListener('change', applyFilter);
    document.getElementById('desaSelect').addEventListener('change', applyFilter);
    document.getElementById('searchInput').addEventListener('input', ()=>{ page=1; applyFilter(); });
    document.getElementById('resetBtn')?.addEventListener('click', ()=>{
      document.getElementById('bulanSelect').value='ALL';
      document.getElementById('desaSelect').value='ALL';
      document.getElementById('searchInput').value='';
      applyFilter();
    });
    document.getElementById('prevBtn').addEventListener('click', ()=>{ if(page>1){ page--; renderBody(); } });
    document.getElementById('nextBtn').addEventListener('click', ()=>{
      const totalPages=Math.max(1, Math.ceil(filtered.length/pageSize));
      if(page<totalPages){ page++; renderBody(); }
    });
    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      const csv = document.getElementById('catinCsv').textContent || '';
      const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='data-catin-2025-long.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // INIT: parse embedded CSV, populate Desa, compute chips, render
    (function init(){
      const csv = (document.getElementById('catinCsv').textContent||'').trim();
      const raw = parseCSV(csv);
      const headers = raw[0].map(h=>(h||'').trim().toUpperCase());
      const idxDesa = headers.indexOf('DESA');
      const idxBln  = headers.indexOf('BULAN');
      const idxJml  = headers.indexOf('JUMLAH');

      data = raw.slice(1).map(cols=>({ 
        DESA: (cols[idxDesa]||'').toUpperCase(), 
        BULAN: Number(cols[idxBln]||0)||0, 
        JUMLAH: Number(cols[idxJml]||0)||0 
      })).filter(r=>r.DESA);

      // Isi dropdown desa
      const desaSel=document.getElementById('desaSelect');
      Array.from(new Set(data.map(r=>r.DESA))).sort((a,b)=>a.localeCompare(b,'id')).forEach(d=>{
        const opt=document.createElement('option'); opt.value=d; opt.textContent=d; desaSel.appendChild(opt);
      });

      // Hitung dan isi chips (global)
      const gByM=new Map();
      for(const r of data){ const m=Number(r.BULAN), j=Number(r.JUMLAH)||0; gByM.set(m,(gByM.get(m)||0)+j); }
      document.querySelectorAll('#chipsBulan .chip').forEach((chip, idx)=>{
        const m=idx+1, count=gByM.get(m)||0;
        chip.innerHTML = `${pad2(m)} ${monthName(m)} <b>(${count})</b>`;
      });

      applyFilter();
    })();
  </script>
</body>
</html>
